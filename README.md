# @gmod/http-range-fetcher

[![NPM version](https://img.shields.io/npm/v/@gmod/http-range-fetcher.svg?style=flat-square)](https://npmjs.org/package/@gmod/http-range-fetcher)
[![Build Status](https://img.shields.io/github/actions/workflow/status/rbuels/http-range-fetcher/push.yml?branch=master)](https://github.com/rbuels/http-range-fetcher/actions?query=branch%3Amaster+workflow%3APush+)

Cache/manager for HTTP byte-range requests that merges requests together and
caches results. Designed for applications that request lots of small byte ranges
over HTTP that are often adjacent to each other.

Works both in node or webpack/browserify. Respects HTTP caching semantics, with
the exception of setting a default minimum TTL of 1 second on requests that are
not really supposed to be cached (e.g. `Cache-Control: no-cache`). You can turn
that behavior off by setting `minimumTTL` to 0 though.

## Install

    $ npm install --save http-range-fetcher

## Usage

```js
const { HttpRangeFetcher } = require('http-range-fetcher')

const cache = new HttpRangeFetcher({})
cache.getRange('http://foo.bar/baz.bam', 20, 10).then(response => {
  assert(response.buffer.length === 10)
  assert(response.headers['content-range'] === '20-29/23422')
  // response objects contain `headers` and `buffer`.  the `headers` object
  // contains the original headers that came from the server in response to the
  // aggregated call, except the Content-Range header has been overwritten
  // to match the requested range, and it adds a X-Resource-Length header that
  // conveniently gives the total length of the remote resource so you don't
  // have to parse the Content-Range header.
  assert(response.headers['x-resource-length'] === '23422')
})

// these will be aggregated behind the scenes
// as a single request for a big chunk of the remote file,
// which will be cached to satisfy subsequent requests
Promise.all([
  cache.getRange('http://foo.bar/baz.bam', 20, 10),
  cache.getRange('http://foo.bar/baz.bam', 30, 10),
  cache.getRange('http://foo.bar/baz.bam', 40, 10),
  cache.getRange('http://foo.bar/baz.bam', 50, 10),
  cache.getRange('http://foo.bar/baz.bam', 60, 10),
  cache.getRange('http://foo.bar/baz.bam', 70, 10),
]).then(fetchResults => {
  fetchResults.forEach(res => assert(res.buffer.length === 10))
})
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

## Academic Use

This package was written with funding from the [NHGRI](http://genome.gov) as
part of the [JBrowse](http://jbrowse.org) project. If you use it in an academic
project that you publish, please cite the most recent JBrowse paper, which will
be linked from [jbrowse.org](http://jbrowse.org).

## License

MIT Â© [Robert Buels](https://github.com/rbuels)

## Note

Renamed http-range-fetcher -> @gmod/http-range-fetcher in 2024
